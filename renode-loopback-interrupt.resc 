$bin ?= @build/CANLoopbackInterrupt

mach create
machine LoadPlatformDescription @platform.repl
showAnalyzer sysbus.uart1

macro reset
"""
   sysbus LoadELF $bin
   sysbus.cpu VectorTableOffset 0x8000000
"""

macro sendCan
"""
   sysbus.gpioPortC.TamperButton Press
   sleep 0.1
   sysbus.gpioPortC.TamperButton Release
"""

sysbus.gpioPortC.TamperButton Release

runMacro $reset
start

runMacro $sendCan
runMacro $sendCan
runMacro $sendCan
